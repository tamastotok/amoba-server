const fs = require('fs');
const path = require('path');

const projectRoot = process.cwd();
const backupDir = path.join(projectRoot, 'log_backups');

// Create backup folder
if (!fs.existsSync(backupDir)) {
  fs.mkdirSync(backupDir);
}

function processFile(filePath) {
  const original = fs.readFileSync(filePath, 'utf8');
  let content = original;

  // Replace console.log â†’ log.info
  content = content.replace(/console\.log/g, 'log.info');

  // Replace console.warn â†’ log.warn
  content = content.replace(/console\.warn/g, 'log.warn');

  // Replace console.error â†’ log.error
  content = content.replace(/console\.error/g, 'log.error');

  if (content !== original) {
    // Backup original file
    const backupPath = path.join(
      backupDir,
      filePath.replace(projectRoot, '') + '.bak'
    );
    const backupFolder = path.dirname(backupPath);

    if (!fs.existsSync(backupFolder)) {
      fs.mkdirSync(backupFolder, { recursive: true });
    }

    fs.writeFileSync(backupPath, original, 'utf8');

    // Write replaced content
    fs.writeFileSync(filePath, content, 'utf8');
    console.log(`Updated logs in: ${filePath}`);
  }
}

function walk(dir) {
  const entries = fs.readdirSync(dir, { withFileTypes: true });

  for (const entry of entries) {
    const fullPath = path.join(dir, entry.name);

    // Skip node_modules
    if (entry.name === 'node_modules' || entry.name.startsWith('.')) continue;

    if (entry.isDirectory()) {
      walk(fullPath);
    } else if (entry.isFile() && fullPath.endsWith('.js')) {
      processFile(fullPath);
    }
  }
}

console.log('ðŸ“¦ Starting console â†’ log.* replacement...');
walk(projectRoot);
console.log('âœ… Replacement complete! Backup at /log_backups');
